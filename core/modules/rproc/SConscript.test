# -*- python -*-
Import('env')
Import('libProducts')

import os
import itertools


programs = []
obj = env.Object("testProtoRowBuffer.cc")
def convertObj(o):
    oStr = str(o)
    # Avoid questionable conflict with .o for SharedLibrary
    # production by using an alt name.
    if oStr.endswith(".cc"): return env.Object(oStr+".staticobj", o)
    return o
libObjs = map(convertObj, libProducts['proto'])
ubuntuDeps=['pthread']
# libcrypto MUST be at the end of the list in order to build successfully on Ubuntu 14.04
p = env.Program(source=[obj], LIBS=['protobuf', 'libssl'] + libObjs + ubuntuDeps+ ['libcrypto'])
programs.append(p)

# add a unit test which runs on every build
utest = env.UnitTest(p)
env.Append(UNIT_TESTS=utest)

Return('programs')
